<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SEU PERFIL</title>
  <style>
    body {
      background: url('fundo.webp') no-repeat center center fixed;
      background-size: cover;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 50px;
    }
    img {
      border-radius: 50%;
      margin-top: 20px;
      width: 120px;
      height: 120px;
    }
    input, button {
      margin: 10px auto;
      display: block;
      padding: 10px;
      border-radius: 5px;
      border: none;
      width: 250px;
      font-size: 1rem;
    }
    button {
      background-color: #00f0ff;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #00c8dd;
    }
    #mensagem {
      margin-top: 10px;
      font-weight: bold;
    }
    ul {
      list-style: none;
      padding: 0;
    }
  </style>
</head>
<body>
  <h1>SEU PERFIL</h1>
  <div id="perfil-container"></div>

  <script>
    const token = localStorage.getItem("discord_token");
    const CEO_ID = "1358576424180518992";
    let gmailDiscord = "";
    let userId = "";

    if (!token) {
      document.body.innerHTML = "<h2>Voc√™ n√£o est√° logado!</h2>";
    } else {
      fetch("https://discord.com/api/v10/users/@me", {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(user => {
        const avatar = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
        const nome = user.global_name || user.username;
        const cargo = user.id === CEO_ID ? "CEO" : "Cliente";
        gmailDiscord = user.email || "";
        userId = user.id;

        // Carregar dados salvos do localStorage
        const dadosSalvos = JSON.parse(localStorage.getItem("perfil_" + userId)) || {};
        const gmailSalvo = dadosSalvos.gmail || "";
        const telefoneSalvo = dadosSalvos.telefone || "";

        document.getElementById("perfil-container").innerHTML = `
          <img src="${avatar}" alt="Avatar do Usu√°rio">
          <h2>${nome}</h2>

          <input type="text" id="gmail" placeholder="Gmail" value="${gmailSalvo}">
          <button onclick="validarGmail()">ADICIONAR GMAIL</button>
          <div id="mensagem"></div>

          <input type="tel" id="telefone" placeholder="Seu n√∫mero (opcional)" value="${telefoneSalvo}">
          <button onclick="salvarTelefone()">SALVAR N√öMERO</button>

          <p><strong>Cargo:</strong> ${cargo}</p>

          ${cargo === "CEO" ? `
            <h3>Permiss√µes do CEO</h3>
            <ul>
              <li>‚úÖ Acesso total</li>
              <li>‚úÖ Gerenciar cargos</li>
              <li>‚úÖ Ver todos os perfis</li>
            </ul>` : `
            <h3>Permiss√µes de Cliente</h3>
            <ul>
              <li>üîí Acesso apenas ao seu perfil</li>
            </ul>`}
        `;
      })
      .catch(() => {
        document.body.innerHTML = "<h2>Erro ao carregar perfil.</h2>";
      });
    }

    function validarGmail() {
      const emailDigitado = document.getElementById("gmail").value.trim();
      const msg = document.getElementById("mensagem");

      if (emailDigitado.toLowerCase() === gmailDiscord.toLowerCase()) {
        msg.style.color = "lightgreen";
        msg.textContent = "GMAIL ADICIONADO";

        salvarDados("gmail", emailDigitado);
      } else {
        msg.style.color = "red";
        msg.textContent = "GMAIL INV√ÅLIDO";
      }
    }

    function salvarTelefone() {
      const telefone = document.getElementById("telefone").value.trim();
      salvarDados("telefone", telefone);
      alert("N√∫mero salvo!");
    }

    function salvarDados(tipo, valor) {
      const chave = "perfil_" + userId;
      const dadosAtuais = JSON.parse(localStorage.getItem(chave)) || {};
      dadosAtuais[tipo] = valor;
      localStorage.setItem(chave, JSON.stringify(dadosAtuais));
    }
  </script>
</body>
</html>
